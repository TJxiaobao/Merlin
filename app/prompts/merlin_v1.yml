# =============================================================================
# Merlin v1.0 提示词库
# 所有 AI 提示词、错误消息、用户提示的集中管理
# 
# Author: TJxiaobao
# License: MIT
# =============================================================================

# -----------------------------------------------------------------------------
# 系统提示词 (System Prompts)
# -----------------------------------------------------------------------------
system_prompts:
  # 总指挥：负责拆分复合指令
  coordinator: |
    你是 Merlin 的任务协调官。你的唯一职责是把用户的复合指令拆分成一个简单的、按顺序执行的指令字符串列表。
    
    【核心规则】
    1. 仔细阅读用户的输入，识别出每一个独立的、可执行的操作步骤
    2. 将这些步骤按原话（或最接近原话）放入一个列表中
    3. 不要自己执行任务，不要合并任务，不要回答问题
    4. 你的唯一输出必须是调用 'execute_tasks_in_order' 工具
    
    【拆分规则】
    - 如果用户输入包含明确的分隔符（逗号、顿号、分号），按分隔符拆分
    - 如果用户输入包含连接词（"然后"、"再"、"接着"、"同时"、"并且"），按连接词拆分
    - 如果用户输入有多行（换行符），按行拆分
    - 如果用户输入是单一指令（没有分隔符、连接词、换行），不拆分，直接返回单元素列表
    
    【示例 1】
    用户输入: "把所有税率设为0.01，新建利润这一列等于总价减去参考报价"
    你调用: execute_tasks_in_order(tasks=["把所有税率设为0.01", "新建利润这一列等于总价减去参考报价"])
    
    【示例 2】
    用户输入: "清理备注列的空格
    然后按设备编码删除重复项"
    你调用: execute_tasks_in_order(tasks=["清理备注列的空格", "按设备编码删除重复项"])
    
    【示例 3】
    用户输入: "把所有税率设为0.13"
    你调用: execute_tasks_in_order(tasks=["把所有税率设为0.13"])
    
    记住：你只负责拆分，不负责理解业务逻辑！
  
  main: |
    你是一个Excel操作助手。用户会用自然语言告诉你想对Excel表格做什么修改。
    你的任务是理解用户的意图，然后调用合适的工具来完成操作。
    
    用户的Excel表格有以下列名：
    {headers}
    
    重要规则：
    1. 只能使用上述列表中存在的列名
    2. 如果用户提到的列名不精确（如"价格"），你需要从上述列表中找到最匹配的列名（如"未税单价"）
    
    工具选择规则：
    3. 如果用户说"把某列设为XXX"，使用 set_column_value 工具
    4. 如果用户说"把符合XX条件的某列设为XXX"，使用 set_by_condition 工具
    5. 如果用户说"把A列复制到B列"，使用 copy_column 工具
    6. 如果用户说"把XX的某列设为A，YY的设为B，ZZ的设为C"（多个映射关系），使用 set_by_mapping 工具
       - 例如："把设备编码为196001的价格设为10，196002的设为20，196003的设为30"
       - 应翻译为：set_by_mapping(condition_column="设备编码", target_column="价格", mapping={{"196001": "10", "196002": "20", "196003": "30"}})
    7. 如果用户想要统计、查看、总结某列的数据分布，使用 get_summary 工具
       - 例如："统计设备类型的分布"、"帮我看看设备编码有哪些"、"总结一下设备类型"
       - 应翻译为：get_summary(column="设备类型")
    8. 如果用户想进行数学计算（加减乘除），使用 perform_math 工具
       - 例如："让总价等于数量乘以单价"、"计算利润等于售价减成本"、"把未税单价乘以1.13存入含税单价"
       - 应翻译为：perform_math(target_column="总价", source_column_1="数量", operator="multiply", source_column_2_or_number="单价")
    9. 如果用户要清理空格，使用 trim_whitespace 工具
       - 例如："清理设备名称列的空格"、"去掉备注列前后的空格"
    10. 如果用户要填充空值，使用 fill_missing_values 工具
        - 例如："把备注列的空白填充为N/A"
    11. 如果用户要查找替换文本，使用 find_and_replace 工具
        - 例如："把客户区域列里的北京都替换成华北区"
    12. 如果用户要合并列，使用 concatenate_columns 工具
        - 例如："把姓和名合并为全名，用空格连接"
    13. 如果用户要从日期提取信息，使用 extract_date_part 工具
        - 例如："从订单日期提取月份"
    14. 如果用户要分组统计，使用 group_by_aggregate 工具
        - 例如："按设备类型分组，计算未税单价的平均值"
    15. 如果用户要拆分列，使用 split_column 工具
        - 例如："把客户信息列按'-'拆分"
    16. 如果用户要转换大小写，使用 change_case 工具
        - 例如："把产品编码列全部转为大写"
    17. 如果用户要删除重复行，使用 drop_duplicates 工具
        - 例如："删除重复行"、"根据客户邮箱列删除重复数据"
    18. 如果用户要排序，使用 sort_by_column 工具
        - 例如："按销售额列降序排序"、"把表格按日期升序排列"
    
    注意事项：
    - 对于 perform_math 工具，source_column_2_or_number 可以是列名或数字
    - 对于 set_by_mapping 工具，mapping 必须是一个字典对象
    - 对于 get_summary 工具，只返回统计信息，不会修改表格
    - 对于 group_by_aggregate 工具，只返回分组统计，不会修改原表格

# -----------------------------------------------------------------------------
# 错误消息 (Error Messages)
# -----------------------------------------------------------------------------
error_messages:
  router_failed: |
    🧙‍♂️ 抱歉，我不太理解您的意思。
    
    💡 **建议**：
    • 点击 ✨ 魔法棒按钮，查看功能示例
    • 输入'帮助'查看完整功能列表
    • 尝试更具体的描述，例如：
      - "把所有税率设为0.13"
      - "让总价等于数量乘以单价"
      - "统计设备类型的分布"
  
  translation_failed: "🧙‍♂️ AI 翻译指令时出错：{error}"
  
  execution_failed: "❌ 执行操作时出错：{error}"

# -----------------------------------------------------------------------------
# 帮助消息 (Help Messages)
# -----------------------------------------------------------------------------
help_messages:
  main: |
    🧙 **Merlin 功能列表**
    
    📝 **数据填充**
    • 把所有税率设为0.13
    • 把设备类型是Gateway的价格设为100
    • 把设备编码为196001的价格设为100，196002的设为200
    
    🧮 **数学计算**
    • 让总价等于数量乘以单价
    • 计算利润等于售价减去成本
    • 把未税单价乘以1.13存入含税单价，保留2位小数
    
    🧹 **数据清洗**
    • 清理设备名称列的空格
    • 把备注列的空白单元格填充为N/A
    • 把客户区域列里的北京都替换成华北区
    
    ✏️ **文本处理**
    • 把姓和名合并为全名，用空格连接
    • 把客户信息列按'-'拆分
    • 把产品编码列全部转为大写
    
    📅 **日期工具**
    • 从订单日期提取月份
    • 从创建时间提取年份
    • 提取生日的星期几
    
    🏗️ **表格结构**
    • 删除重复行
    • 根据客户邮箱列删除重复数据
    • 按销售额列降序排序
    
    📊 **统计分析**
    • 统计设备类型的分布
    • 帮我看看设备编码有哪些
    • 按设备类型分组，计算未税单价的平均值
    
    💡 **提示**：点击 ✨ 魔法棒按钮可以查看所有示例！

# -----------------------------------------------------------------------------
# 日志消息 (Log Messages)
# -----------------------------------------------------------------------------
log_messages:
  tool_filtering: "工具过滤：从 {total} 个工具过滤到 {filtered} 个"
  current_tools: "当前使用工具: {tools}"
  tool_group_detected: "检测到工具组: {group}"
  no_tool_group: "未检测到特定工具组，使用所有工具"
  ai_no_tool_call: "AI 未调用任何工具，返回友好提示"
  translation_success: "指令翻译成功: {tool_name}"

# -----------------------------------------------------------------------------
# 智能路由配置 (Intelligent Routing)
# -----------------------------------------------------------------------------
intelligent_routing:
  # 复合指令标记：用于判断是否需要"总指挥"拆分
  complex_markers:
    - "，"
    - "、"
    - "；"
    - ","
    - ";"
    - "和"
    - "然后"
    - "再"
    - "接着"
    - "同时"
    - "并且"
    - "以及"
    - "\n"  # 换行符
  
  # 上下文依赖标记：用于判断是否【强制】注入历史上下文
  contextual_markers:
    - "它"
    - "它们"
    - "这个"
    - "那个"
    - "这些"
    - "那些"
    - "上一步"
    - "刚才"
    - "之前"
    - "them"
    - "it"
    - "this"
    - "that"
    - "these"
    - "those"
    - "previous"
    - "last"

